<!DOCTYPE html>
<html>
<head>
  <title>Generate Invoice</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body{background:#f4f6f9;}
    .sidebar{
      width:220px;
      height:100vh;
      position:fixed;
      background:linear-gradient(#0d6efd,#00c6ff);
      color:white;
      padding:20px;
    }
    .sidebar a{
      display:block;
      color:white;
      padding:10px;
      text-decoration:none;
    }
    .main{
      margin-left:230px;
      padding:20px;
    }
    input, textarea{
      background:#eef1f7 !important;
    }
  </style>
</head>

<body>

<div class="sidebar">
  <h4>Invoice</h4>
  <a href="dashboard.html">Dashboard</a>
  <a href="groups.html">Manage Groups</a>
  <a href="manage-chains.html">Manage Chain</a>
  <a href="manage-brands.html">Manage Brands</a>
  <a href="manage-subzones.html">Manage SubZones</a>
  <a href="manage-estimate.html">Manage Estimate</a>
  <a href="#"><b>Manage Invoices</b></a>
</div>

<div class="main">

<h3>Generate Invoice</h3>

<div class="row">

<div class="col-md-4">
<label>Invoice No:</label>
<input type="text" id="invoiceNo" class="form-control" disabled>
</div>

<div class="col-md-4">
<label>Estimate ID:</label>
<input type="text" id="estimateId" class="form-control" disabled>
</div>

<div class="col-md-4">
<label>Chain ID:</label>
<input type="text" id="chainId" class="form-control" disabled>
</div>

<div class="col-md-4 mt-3">
<label>Service:</label>
<input type="text" id="service" class="form-control" disabled>
</div>

<div class="col-md-4 mt-3">
<label>Quantity:</label>
<input type="text" id="qty" class="form-control" disabled>
</div>

<div class="col-md-4 mt-3">
<label>Cost per Unit:</label>
<input type="text" id="cost" class="form-control" disabled>
</div>

<div class="col-md-4 mt-3">
<label>Total Amount:</label>
<input type="text" id="total" class="form-control" disabled>
</div>

<div class="col-md-4 mt-3">
<label>Amount Paid:</label>
<input type="number" id="paid" class="form-control">
</div>

<div class="col-md-4 mt-3">
<label>Balance:</label>
<input type="text" id="balance" class="form-control" disabled>
</div>

<div class="col-md-4 mt-3">
<label>Email:</label>
<input type="email" id="email" class="form-control">
</div>

</div>

<br>

<button class="btn btn-success" onclick="generatePDF()">Generate Invoice</button>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>

let params = new URLSearchParams(window.location.search);
let index = params.get("id");

let estimates = JSON.parse(localStorage.getItem("estimates")) || [];
let data = estimates[index];

document.getElementById("invoiceNo").value = "INV-" + (1000 + Number(index));
document.getElementById("estimateId").value = data.estimate;
document.getElementById("chainId").value = data.chain;
document.getElementById("service").value = data.service;
document.getElementById("qty").value = data.units;
document.getElementById("cost").value = data.price;
document.getElementById("total").value = data.total;

document.getElementById("paid").addEventListener("input",()=>{
  let paid = document.getElementById("paid").value;
  document.getElementById("balance").value =
    data.total - paid;
});

function generate(){
  alert("Invoice Generated Successfully");
}



function generatePDF() {

    // 1️⃣ jsPDF object create
    const { jsPDF } = window.jspdf;
    let doc = new jsPDF();

    // 2️⃣ Form data read
    let invoiceNo = document.getElementById("invoiceNo").value;
    let estimateId = document.getElementById("estimateId").value;
    let chainId = document.getElementById("chainId").value;
    let service = document.getElementById("service").value;
    let qty = document.getElementById("qty").value;
    let cost = document.getElementById("cost").value;
    let total = document.getElementById("total").value;
    let paid = document.getElementById("paid").value;
    let balance = document.getElementById("balance").value;

    // 3️⃣ Title add
    doc.setFontSize(18);
    doc.text("INVOICE", 90, 20);

    // 4️⃣ Invoice details likhna PDF me
    doc.setFontSize(12);
    doc.text("Invoice No: " + invoiceNo, 20, 40);
    doc.text("Estimate ID: " + estimateId, 20, 50);
    doc.text("Chain ID: " + chainId, 20, 60);
    doc.text("Service: " + service, 20, 70);
    doc.text("Units: " + qty, 20, 80);
    doc.text("Price per Unit: " + cost, 20, 90);
    doc.text("Total Amount: " + total, 20, 100);
    doc.text("Paid Amount: " + paid, 20, 110);
    doc.text("Balance: " + balance, 20, 120);

    // 5️⃣ PDF download
    doc.save(invoiceNo + ".pdf");

}


</script>

</body>
</html>