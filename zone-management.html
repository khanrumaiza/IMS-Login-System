<!DOCTYPE html>
<html>

<head>
    <title>IMS - Zone Management</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f9;
        }

        .sidebar {
            height: 100vh;
            background: #0d6efd;
            color: white;
            padding: 20px;
            width: 230px;
        }

        .sidebar a {
            display: block;
            margin: 10px 0;
            padding: 12px;
            text-decoration: none;
            color: white;
        }

        .sidebar a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .card-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>

    <div class="container-fluid">
        <div class="row">

            <!-- SIDEBAR -->
            <div class="col-md-3 sidebar">
                <h4>Invoice</h4>
                <a href="dashboard.html">Dashboard</a>
                <a href="groups.html">Manage Groups</a>
                <a href="brand-management.html">Manage Brands</a>
                <a href="zone-management.html"><b>Manage SubZones</b></a>
                <a href="#">Manage Estimates</a>
                <a href="#">Manage Invoices</a>
            </div>

            <!-- MAIN -->
            <div class="col-md-9 p-4">

                <h3 class="mb-4">Manage Zone Section</h3>

                <div class="row">

                    <!-- TABLE -->
                    <div class="col-md-8">
                        <div class="card-box">
                            <h5>Total Zones: <span id="count">0</span></h5>

                            <table class="table mt-3">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Group</th>
                                        <th>Brand</th>
                                        <th>Zone</th>
                                        <th>Edit</th>
                                        <th>Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="zoneList"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ADD ZONE -->
                    <div class="col-md-4">

                        <div class="card-box mb-3">
                            <h5>Add Zone</h5>

                            <select id="groupSelect" class="form-control mb-2"></select>

                            <select id="brandSelect" class="form-control mb-2"></select>

                            <input type="text" id="zoneName" class="form-control mb-2" placeholder="Enter Zone">

                            <button class="btn btn-primary w-100" onclick="addZone()">Add Zone</button>
                        </div>

                        <div class="card-box">
                            <h5>Filter</h5>

                            <select id="filterGroup" class="form-control mb-2" onchange="filterZones()"></select>
                            <select id="filterBrand" class="form-control" onchange="filterZones()"></select>

                        </div>

                    </div>
                </div>
            </div>
        </div>

        <script>

            /* STORAGE */

            let groups = JSON.parse(localStorage.getItem("groups")) || [];
            let brands = JSON.parse(localStorage.getItem("brands")) || [];
            let zones = JSON.parse(localStorage.getItem("zones")) || [];

            /* FIX STRUCTURE */

            groups = groups.map(g => typeof g === "string" ? { name: g } : g);
            brands = brands.map(b => typeof b === "string" ? { name: b } : b);

            localStorage.setItem("groups", JSON.stringify(groups));
            localStorage.setItem("brands", JSON.stringify(brands));


            /* LOAD DROPDOWNS */

            function loadDropdowns() {

                let groupSelect = document.getElementById("groupSelect");
                let brandSelect = document.getElementById("brandSelect");
                let filterGroup = document.getElementById("filterGroup");
                let filterBrand = document.getElementById("filterBrand");

                groupSelect.innerHTML = "<option>Select Group</option>";
                brandSelect.innerHTML = "<option>Select Brand</option>";
                filterGroup.innerHTML = "<option value=''>All Groups</option>";
                filterBrand.innerHTML = "<option value=''>All Brands</option>";

                groups.forEach(g => {
                    groupSelect.innerHTML += `<option>${g.name}</option>`;
                    filterGroup.innerHTML += `<option>${g.name}</option>`;
                });

                brands.forEach(b => {
                    brandSelect.innerHTML += `<option>${b.name}</option>`;
                    filterBrand.innerHTML += `<option>${b.name}</option>`;
                });
            }


            /* ADD ZONE */

            function addZone() {

                let group = document.getElementById("groupSelect").value;
                let brand = document.getElementById("brandSelect").value;
                let zone = document.getElementById("zoneName").value.trim();

                if (group === "Select Group" || brand === "Select Brand" || !zone) {
                    alert("All fields required");
                    return;
                }

                let exists = zones.find(z =>
                    z.group === group && z.brand === brand && z.zone.toLowerCase() === zone.toLowerCase()
                );

                if (exists) {
                    alert("Zone already exists");
                    return;
                }

                zones.push({ group, brand, zone });
                localStorage.setItem("zones", JSON.stringify(zones));

                renderZones();
            }


            /* RENDER TABLE */

            function renderZones(data = zones) {

                let list = document.getElementById("zoneList");
                list.innerHTML = "";

                data.forEach((z, i) => {
                    list.innerHTML += `
<tr>
<td>${i + 1}</td>
<td>${z.group}</td>
<td>${z.brand}</td>
<td>${z.zone}</td>
<td><button class="btn btn-warning btn-sm" onclick="editZone(${i})">Edit</button></td>
<td><button class="btn btn-danger btn-sm" onclick="deleteZone(${i})">Delete</button></td>
</tr>
`;
                });

                document.getElementById("count").innerText = data.length;
            }


            /* DELETE */

            function deleteZone(i) {
                zones.splice(i, 1);
                localStorage.setItem("zones", JSON.stringify(zones));
                renderZones();
            }


            /* EDIT */

            function editZone(i) {
                let newZone = prompt("Update zone name", zones[i].zone);
                if (newZone) {
                    zones[i].zone = newZone;
                    localStorage.setItem("zones", JSON.stringify(zones));
                    renderZones();
                }
            }


            /* FILTER */

            function filterZones() {

                let g = document.getElementById("filterGroup").value;
                let b = document.getElementById("filterBrand").value;

                let filtered = zones.filter(z => {
                    return (g === "" || z.group === g) && (b === "" || z.brand === b);
                });

                renderZones(filtered);
            }


            /* INIT */

            loadDropdowns();
            renderZones();

        </script>

</body>

</html>