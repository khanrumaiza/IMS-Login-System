<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Manage Estimate</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f9;
            font-family: Arial;
        }

        /* Sidebar */
        .sidebar {
            height: 100vh;
            background: linear-gradient(#0048ff, #00bfff);
            color: white;
            padding: 20px;
        }

        .sidebar a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 10px;
            margin: 5px 0;
        }

        .sidebar a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Cards */
        .card-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        /* Buttons */
        .btn-edit {
            background: orange;
            color: white;
            border: none;
            padding: 5px 10px;
        }

        .btn-delete {
            background: red;
            color: white;
            border: none;
            padding: 5px 10px;
        }
    </style>
</head>

<body>

<div class="container-fluid">
<div class="row">

    <!-- SIDEBAR -->
    <div class="col-md-2 sidebar">
        <h4>Invoice</h4>
        <a href="dashboard.html">Dashboard</a>
        <a href="groups.html">Manage Groups</a>
        <a href="manage-chains.html">Manage Chain</a>
        <a href="brand-management.html">Manage Brands</a>
        <a href="zone-management.html">Manage SubZones</a>
        <a href="manage-estimate.html"><b>Manage Estimate</b></a>
        <a href="manage-invoices.html">Manage Invoices</a>
    </div>

    <!-- MAIN CONTENT -->
    <div class="col-md-10 p-4">

        <!-- TOTAL ESTIMATE -->
        <div class="card-box mb-3 text-center" style="background:#ff4d4d;color:white;">
            <h4>Total Estimate</h4>
            <h2 id="grandTotal">0</h2>
        </div>

        <!-- CREATE ESTIMATE -->
        <div class="card-box mb-3">
            <h5>Create Estimate</h5>

            <div class="row">
                <div class="col">
                    <input type="text" id="group" class="form-control" placeholder="Group">
                </div>

                <div class="col">
                    <input type="text" id="chain" class="form-control" placeholder="Chain ID">
                </div>

                <div class="col">
                    <input type="text" id="estimate" class="form-control" placeholder="Estimate ID">
                </div>

                <div class="col">
                    <input type="text" id="brand" class="form-control" placeholder="Brand">
                </div>

                <div class="col">
                    <input type="text" id="zone" class="form-control" placeholder="Zone">
                </div>
            </div>

            <br>

            <div class="row">
                <div class="col">
                    <input type="text" id="service" class="form-control" placeholder="Service Details">
                </div>

                <div class="col">
                    <input type="number" id="units" class="form-control" placeholder="Total Units">
                </div>

                <div class="col">
                    <input type="number" id="price" class="form-control" placeholder="Price Per Unit">
                </div>

                <div class="col">
                    <button class="btn btn-primary" onclick="addEstimate()">Add</button>
                </div>
            </div>
        </div>

        <!-- TABLE -->
        <div class="card-box">
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Sr.No</th>
                    <th>Group</th>
                    <th>Chain ID</th>
                    <th>Estimate ID</th>
                    <th>Brand</th>
                    <th>Zone</th>
                    <th>Service</th>
                    <th>Units</th>
                    <th>Price</th>
                    <th>Total</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
                </thead>

                <tbody id="estimateTable"></tbody>
            </table>
        </div>

    </div>
</div>
</div>

<script>

let estimates = JSON.parse(localStorage.getItem("estimates")) || [];

function saveData() {
    localStorage.setItem("estimates", JSON.stringify(estimates));
    renderTable();
}

function addEstimate() {

    let group = document.getElementById("group").value;
    let chain = document.getElementById("chain").value;
    let estimate = document.getElementById("estimate").value;
    let brand = document.getElementById("brand").value;
    let zone = document.getElementById("zone").value;
    let service = document.getElementById("service").value;
    let units = Number(document.getElementById("units").value);
    let price = Number(document.getElementById("price").value);

    if (!group || !chain || !estimate || !brand || !zone || !service || !units || !price) {
        alert("Please fill all fields");
        return;
    }

    let total = units * price;

    estimates.push({ group, chain, estimate, brand, zone, service, units, price, total });

    saveData();

    // clear fields
    document.querySelectorAll("input").forEach(i => i.value = "");
}

function renderTable() {

    let table = document.getElementById("estimateTable");
    table.innerHTML = "";

    let grandTotal = 0;

    estimates.forEach((e, i) => {

        grandTotal += e.total;

        table.innerHTML += `
        <tr>
            <td>${i + 1}</td>
            <td>${e.group}</td>
            <td>${e.chain}</td>
            <td>${e.estimate}</td>
            <td>${e.brand}</td>
            <td>${e.zone}</td>
            <td>${e.service}</td>
            <td>${e.units}</td>
            <td>${e.price}</td>
            <td>${e.total}</td>
            <td><button class="btn-edit" onclick="editEstimate(${i})">Edit</button></td>
            <td><button class="btn-delete" onclick="deleteEstimate(${i})">Delete</button></td>
        </tr>
        `;
    });

    document.getElementById("grandTotal").innerText = grandTotal;
}

function deleteEstimate(index) {
    estimates.splice(index, 1);
    saveData();
}

function editEstimate(index) {
    let e = estimates[index];

    document.getElementById("group").value = e.group;
    document.getElementById("chain").value = e.chain;
    document.getElementById("estimate").value = e.estimate;
    document.getElementById("brand").value = e.brand;
    document.getElementById("zone").value = e.zone;
    document.getElementById("service").value = e.service;
    document.getElementById("units").value = e.units;
    document.getElementById("price").value = e.price;

    deleteEstimate(index);
}

renderTable();

</script>

</body>
</html>